# Interprocess Communication in A microservice Architecture 

Whithin a monolithic application modules invoke one another via language 
level method or function calls. microservices interact with each other 
using RPC since they are implemented as a set of separate services.

There's no shortage of RPC mechanisms to choose from, the most common IPC 
mechanism used for microservice architectures is REST.

## Overview of IPC in a microservice architecture 

Services can use either syncrhonous request/response based communication mechanisms such as HTTP based REST or gRPC. Alternatively they can use 
asynchronous, message-based communication mechanisms such as AMPQ or STOMP. 

There are also a variety of different message formats such as JSON or XML.
Alternatively, they could use a more efficient binary format such as Avro 
or Protocl Buffers.

### Interaction styles 

The choice of the interaction style impacts the availability of your application. 
There are a variety of client-service interaction styles, they can be 
categorized in two dimensions. 

* The first dimension is whether the interaction is one-to-one or many-to-many: 
    - One-to-One: Each client request is processed by exactly one service 
    - One-to-Many: Each request is processed by multiple services.

* The second dimension is whether the interaction is synchronous or asyncrhonous: 
    - Syncronous: The client expects a timely response from the service and 
    might even block while it waits. 
    - Asyncrhonous: The client doesn't block, and the response, if any isn't 
    necesserily sent immediately


The following are the different types of one-to-one interactions:

    - Request/response: A service client makes a request to a service and 
    waits for a response. 

    - Asynchronous request/response: A service client sends a request to a service, which replies asyncrhonously.

    - One way notifications: A service client sends a request to a service, 
    but no reply is expected or sent


The following are the different types of one-to-many interactions: 

    - Publish subscribe: A client publishes a notification message, 
    which is consumed by zero or more interested services. 

    - Publish/async responses, A client publishes a request message and then 
    waits for a certain amount of time for responses from interested services

### Defining APIs in a MS architecture 

A service API is a contract between the service and its clients. it consists
of operations, which clients can invoke, and events which are published by 
the service. An operation has a name

Regardless of which IPC mechanism you choose, it's important to precisely
define a service's API using some kind of interface definition language (IDL)

First you write the interface definition. Then you review the interface 
definition with the client developers. Only after iterating on the API 
definition you then implement the service


* The nature of the API definition depends on which IPC mechanisms you're using. For example, if you're using messaging the API consists of message 
* channels, the message types and the message format. 

* If you're using HTTP the API consists of the URL, the HTTP verbs, and the 
* requests and response formats.


### Evolving APIs 

APIs inevitably change overtime as new features are added, existing features
are changed and perhaps old features are removed


* Use semantic versioning

The semantic versioning specification is a useful guide to versioning APIs. 
[Semver](https://semver.org) 
It's a set of rules that specify how version numbers are used and incremented
Semantic versioning

    - MAJOR: When you make an incompatible change to the API. 
    - MINOR: When you make backward compatible enhancements to the API
    - PATCH: When you make a backward compatible bug fix.


### Message Formats 

    There are two main categories of message formats: 
        - Text based : (JSON & XML)
        - Binary (Protobuf & Avro)